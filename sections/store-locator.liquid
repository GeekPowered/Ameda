<link rel="stylesheet" href="{{ 'store-locator.css' | asset_url }}" media="print" onload="this.media='all'">

<div class="section section--padding">
  <div class="container">
    <p class="text-center h4">E is for Elites, P is for Platinums. Other is everything else.</p>
    <ul class="state-selector" id="stateList">
      {% assign unique_states = "" | split: "," %}
      {% for store_location in shop.metaobjects.store_location.values %}
        {% unless unique_states contains store_location.state_province %}
          {% assign unique_states = unique_states | push: store_location.state_province %}
          <li class="state-link"><a href="#{{ store_location.state_province }}">{{ store_location.state_province }}</a></li>
        {% endunless %}
      {% endfor %}
    </ul>
  </div>
</div>

<div class="section section--padding">
  <div class="container">
    <div class="store-locations">
      {% for store_location in shop.metaobjects.store_location.values %}
        <div class="store-location">
          <h3 class="h5">{{ store_location.title }}</h2>
          
          {% if store_location.short_description %}
            <p><strong>Short Description:</strong> {{ store_location.short_description }}</p>
          {% endif %}
          
          {% if store_location.website %}
            <p><strong>Website:</strong> <a target="_blank" href="{{ store_location.website }}">{{ store_location.website }}</a></p>
          {% endif %}
          
          {% if store_location.address %}
            <p><strong>Address:</strong> {{ store_location.address }}</p>
          {% endif %}
          
          {% if store_location.city %}
            <p><strong>City:</strong> {{ store_location.city }}</p>
          {% endif %}
          
          {% if store_location.state_province %}
            <p><strong>State / Province:</strong> <span state="{{ store_location.state_province }}">{{ store_location.state_province }}<span></p>
          {% endif %}
          
          {% if store_location.country %}
            <p><strong>Country:</strong> {{ store_location.country }}</p>
          {% endif %}
          
          {% if store_location.zip %}
            <p><strong>Zip:</strong> {{ store_location.zip }}</p>
          {% endif %}
          
          {% if store_location.email %}
            <p><a class="btn btn--primary" href="mailto:{{ store_location.email }}">{{ store_location.email }}</a></p>
          {% endif %}
          
          {% if store_location.phone_number %}
            <p class="m-0"><a class="btn btn--primary" href="tel:{{ store_location.phone_number }}">{{ store_location.phone_number }}</a></p>
          {% endif %}
        </div>
      {% endfor %}
    </div>
  </div>
</div>

<script>
  document.addEventListener('DOMContentLoaded', function() {
    // Sorting the state list alphabetically
    var stateList = document.getElementById('stateList');
    var items = stateList.getElementsByClassName('state-link');
    var itemsArray = Array.from(items);

    itemsArray.sort(function(a, b) {
      var textA = a.textContent || a.innerText;
      var textB = b.textContent || b.innerText;
      return textA.localeCompare(textB);
    });

    itemsArray.forEach(function(item) {
      stateList.appendChild(item);
    });

    // Sorting store locations by state
    var storeLocations = document.querySelectorAll('.store-location');
    var storeLocationsArray = Array.from(storeLocations);

    storeLocationsArray.sort(function(a, b) {
      var stateA = a.querySelector('span[state]').getAttribute('state');
      var stateB = b.querySelector('span[state]').getAttribute('state');
      return stateA.localeCompare(stateB);
    });

    var storeLocationsContainer = document.querySelector('.store-locations');
    storeLocationsArray.forEach(function(item) {
      storeLocationsContainer.appendChild(item);
    });

    // Click event listener for state links
    stateList.addEventListener('click', function(event) {
      if (event.target.tagName === 'A') {
        event.preventDefault();

        // Get the target state from the clicked link
        var targetState = event.target.getAttribute('href').substring(1);

        // Find the nearest store-location with a matching state attribute
        var matchingCard = document.querySelector('.store-location span[state="' + targetState + '"]').closest('.store-location');

        // Scroll to the matching card, accounting for header height
        if (matchingCard) {
          var headerHeight = document.querySelector('.header').offsetHeight;
          var targetScrollPosition = matchingCard.offsetTop - headerHeight;

          window.scrollTo({
            top: targetScrollPosition,
            behavior: 'smooth'
          });
        }
      }
    });
  });
</script>



{% schema %}
{
  "name": "Locations",
  "presets": [
    {
      "name": "Locations",
      "category": "Template"
    }
  ]
}
{% endschema %}