<link rel="stylesheet" href="{{ 'store-locator.css' | asset_url }}" media="print" onload="this.media='all'">

{% assign all_store_locations = shop.metaobjects.store_location.values | sort: 'state_province' %}
{% assign items_per_page = 10 %} {% comment %} Set the number of items per page {% endcomment %}
{% assign total_pages = all_store_locations | size | divided_by: items_per_page | ceil %}
{% assign current_page = 1 %}
{% assign start_index = (current_page - 1) * items_per_page %}
{% assign end_index = start_index | plus: items_per_page | minus: 1 %}
{% assign current_page_items = all_store_locations | slice: start_index, end_index %}

<div class="section section--padding">
  <div class="container">
    <p class="text-center h4">E is for Elites, P is for Platinums. Other is everything else.</p>
    <ul class="state-selector" id="stateList">
      <li><strong>FIND BY STATE:</strong></li>
      {% assign state_provinces = all_store_locations | map: 'state_province' | uniq | sort %}
      {% for state in state_provinces %}
        {% if state != blank %}
          <li class="state-link"><a href="#{{ state }}">{{ state }}</a></li>
        {% endif %}
      {% endfor %}
    </ul>
  </div>
</div>

<div class="section section--padding">
  <div class="container">
    <div class="store-locations">
      {% for store_location in current_page_items %}
        {% if current_state != store_location.state_province %}
          {% assign current_state = store_location.state_province %}
          <div class="store-location" id="{{ store_location.state_province }}">
        {% else %}
          <div class="store-location">
        {% endif %}
            <div class="location-content">
                <h3 class="store-title h5" {% if store_location.short_description != blank %}style="padding-right: 3.5rem;"{% endif %}>{{ store_location.title }}</h3>
            
                {% if store_location.short_description %}
                  <span class="short-desc">{{ store_location.short_description }}</span>
                {% endif %}
                
                <p class="mb-0">
                  {% if store_location.address %}{{ store_location.address }}{% endif %}{% if store_location.city %} {{ store_location.city }}{% endif %},</br>{% if store_location.state_province %} {{ store_location.state_province }}{% endif %}{% if store_location.zip %} {{ store_location.zip }}{% endif %}{% if store_location.country %} {{ store_location.country }}{% endif %}
                </p>
            </div>

            <div class="location-content">
              {% if store_location.email %}
                <a class="link-with-icon btn btn--primary" href="mailto:{{ store_location.email }}">{% render 'icon-mail' %} {{ store_location.email }}</a>
              {% endif %}
            
              {% if store_location.phone_number %}
                <a class="link-with-icon btn btn--primary" href="tel:{{ store_location.phone_number }}">{% render 'icon-phone' %} {{ store_location.phone_number }}</a>
              {% endif %}
  
              {% if store_location.website %}
                <a class="link-with-icon btn btn--primary" target="_blank" href="{{ store_location.website }}">{% render 'icon-link' %} Visit Website</a>
              {% endif %}
            </div>
          </div>
      {% endfor %}
    </div>
  </div>
</div>


{% schema %}
{
  "name": "Locations",
  "presets": [
    {
      "name": "Locations",
      "category": "Template"
    }
  ]
}
{% endschema %}