<link rel="stylesheet" href="{{ 'store-locator.css' | asset_url }}" media="print" onload="this.media='all'">

<div class="section section--padding">
  <div class="container">
    <p class="text-center h4">E is for Elites, P is for Platinums. Other is everything else.</p>
    <ul class="state-selector" id="stateList">
      <li><strong>FIND BY STATE:</strong></li>
      {% assign unique_states = '' | split: ',' %}
      {% for block in section.blocks %}
        {% assign state_province = block.settings.state_province %}
        {% unless unique_states contains state_province %}
          <button class="state-link">{{ state_province }}</button>
          {% assign unique_states = unique_states | join: ',' | append: ',' | append: state_province | split: ',' %}
        {% endunless %}
      {% endfor %}
    </ul>
  </div>
</div>

{% assign csv_rows = 'https://cdn.shopify.com/s/files/1/0849/8062/9819/files/product-locations.csv?v=1706209591' | asset_url | csv %}
<div class="section section--padding">
  <div class="container">
    <div class="store-locations" id="storeLocationsContainer">
      {% for row in csv_rows %}
        <div class="store-location" data-stateprovince="{{ row.state_province }}">
          <h3>{{ row.title }}</h3>
          <p>{{ row.address }}</p>
        </div>
      {% endfor %}
    </div>
  </div>
</div>


<script>
  document.addEventListener("DOMContentLoaded", function () {
    // Get the container element
    var container = document.getElementById("storeLocationsContainer");

    // Get all the store location elements
    var storeLocations = container.querySelectorAll(".store-location");

    // Convert the NodeList to an array
    var storeLocationsArray = Array.from(storeLocations);

    // Sort the store locations by state_province attribute
    storeLocationsArray.sort(function (a, b) {
      var stateA = a.getAttribute("data-stateprovince").toUpperCase();
      var stateB = b.getAttribute("data-stateprovince").toUpperCase();
      if (stateA < stateB) {
        return -1;
      }
      if (stateA > stateB) {
        return 1;
      }
      return 0;
    });

    // Clear the container
    container.innerHTML = "";

    // Append the sorted store locations back to the container
    storeLocationsArray.forEach(function (location) {
      container.appendChild(location);
    });
  });
</script>

{% schema %}
{
  "name": "Product Locator",
  "presets": [
    {
      "name": "Product Locator",
      "category": "Custom"
    }
  ]
}
{% endschema %}