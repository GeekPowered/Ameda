<link rel="stylesheet" href="{{ 'store-locator.css' | asset_url }}" media="print" onload="this.media='all'">

<div class="section section--padding">
  <div class="container">
    <p class="text-center h4">E is for Elites, P is for Platinums. Other is everything else.</p>
    <ul class="state-selector" id="stateList">
      <li><strong>FIND BY STATE:</strong></li>
      {% assign unique_states = '' | split: ',' %}
      {% for block in section.blocks %}
        {% assign state_province = block.settings.state_province %}
        {% unless unique_states contains state_province %}
          <button class="state-link">{{ state_province }}</button>
          {% assign unique_states = unique_states | join: ',' | append: ',' | append: state_province | split: ',' %}
        {% endunless %}
      {% endfor %}
    </ul>
  </div>
</div>

{% assign csv_rows = 'https://cdn.shopify.com/s/files/1/0849/8062/9819/files/product-locations.csv?v=1706209591' | asset_url | csv %}
<div class="section section--padding">
  <div class="container">
    <div class="store-locations" id="storeLocationsContainer">
      {% for row in csv_rows %}
        <div class="store-location" data-stateprovince="{{ row.state_province }}">
          <div class="location-content">
            <h3 class="store-title h5" {% if row.short_description != blank %}style="padding-right: 3.5rem;"{% endif %}>{{ row.title }}</h3>
            {% if row.short_description != blank %}
              <span class="short-desc">{{ row.short_description }}</span>
            {% endif %}
            {% if row.description != blank %}
              <p>{{ row.description }}</p>
            {% endif %}
            {% if row.address != blank %}
              <p class="mb-0">{{ row.address }}</p>
            {% endif %}
            {% if row.city != blank %}
              <p class="mb-0">{{ row.city }}</p>
            {% endif %}
            {% if row.state != blank %}
              <p class="mb-0">{{ row.state }}</p>
            {% endif %}
            {% if row.zip != blank %}
              <p class="mb-0">{{ row.zip }}</p>
            {% endif %}
            {% if row.country != blank %}
              <p class="mb-0">{{ row.country }}</p>
            {% endif %}
          </div>
          <div class="location-content">
            {% if row.email != blank %}
              <a class="link-with-icon btn btn--primary" href="mailto:{{ row.email }}">
                Email {{ row.email }}
              </a>
            {% endif %}
            {% if row.phone_number != blank %}
              <a class="link-with-icon btn btn--primary" href="tel:{{ row.phone_number }}">
                Call {{ row.phone_number }}
              </a>
            {% endif %}
            {% if row.website != blank %}
              <a class="link-with-icon btn btn--primary" target="_blank" href="{{ row.website }}">
                Visit Website
              </a>
            {% endif %}
          </div>
        </div>
      {% endfor %}
    </div>
  </div>
</div>


<script>
  document.addEventListener("DOMContentLoaded", function () {
    // Get the container element
    var container = document.getElementById("storeLocationsContainer");

    // Get all the store location elements
    var storeLocations = container.querySelectorAll(".store-location");

    // Convert the NodeList to an array
    var storeLocationsArray = Array.from(storeLocations);

    // Sort the store locations by state_province attribute
    storeLocationsArray.sort(function (a, b) {
      var stateA = a.getAttribute("data-stateprovince").toUpperCase();
      var stateB = b.getAttribute("data-stateprovince").toUpperCase();
      if (stateA < stateB) {
        return -1;
      }
      if (stateA > stateB) {
        return 1;
      }
      return 0;
    });

    // Clear the container
    container.innerHTML = "";

    // Append the sorted store locations back to the container
    storeLocationsArray.forEach(function (location) {
      container.appendChild(location);
    });
  });
</script>

{% schema %}
{
  "name": "Product Locator",
  "presets": [
    {
      "name": "Product Locator",
      "category": "Custom"
    }
  ]
}
{% endschema %}